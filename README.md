# 2024-2_ROKEYBOOTCAMP_intelligence_AI_project_1
  - 2025/01/22~2025/01/31, 설날을 포함, 약 10일 동안 진행한 프로젝트이다.
  - 컨테이너 기반 칩(기판) 불량 시스템 구축이 프로젝트의 주제이다.

## 첫번째 프로젝트(예시)
  - 칩의 구성용품 라벨링 프로젝트

| 주제                 | 내용                                                         |
|-----------------------|-------------------------------------------------------------|
| Data Type            | Image(jpg)                                                  |
| Data Amount          | 132장, 배치 1 : 66 장, 배치 2 : 66장                        |
| Expected Labeling Unit per Data | 0 ~ 9개                                              |
| Brief Description    | 주어진 이미지에서 객체를 bounding box 하는것 - 칩의 구성요소를 파악하는 bounding box 진행하기 |
| 종료 희망 날짜        | - 배치 1 : ~2025-1-22까지, - 배치 2 : ~ 2025-1-22까지       |
| Customer Guideline   | ![Screenshot from 2025-01-22 14-28-14](https://github.com/user-attachments/assets/1e5a0b7c-62d5-4dc1-bd51-251a0c3bae7d) </br>빨간색 : RASPBERRY PICO , 주황색 : HOLE, 노란색 : BOOTSEL, 연두색 : OSCILLATOR, 파란색 : USB, 보라색 : CHIPSET|
| Data Collection      | 강사님 제공 데이터                                           |
| Annotation Type      | Bounding Box : 6종                                          |
| Class                | 1. RASPBERRY PICO, 2. HOLE, 3. BOOTSEL, 4. OSCILLATOR, 5. USB, 6. CHIPSET |
| Property             | 없음                                                        |
| Misc                 | 칩이 사진에 짤리거나 컨테이너 바깥쪽에 걸쳐서 구성용품이 짤릴 경우 구성용품의 50프로 이상이 보일 경우, 바운딩 박스를 한다. 주변이 너무 하얗거나 너무 어두워서 edge가 흐려져서 1면만 있을 경우, bounding box를 하지 않는다. 또한 bounding box를 할 때 최대한 여백을 주지 않는다. USB는 RASPBERRY PICO에 포함한다. |
|Contact Info|이선우,김영수,한건희,최범석|

|class                      |Annotation type          |부가설명                    |
|--------------------------|--------------------------|--------------------------|
|RASPBERRY PICO|Bounding Box|전체 칩 모형|
|HOLE          |Bounding Box|칩을 고정할 수 있는 4개의 핀|
|BOOTSEL        |Bounding Box|부트시 필요한 데이터를 저장하는 메로리|
|OSCILLATOR      |Bounding Box|주기 신호를 생성하는 칩|
|USB            |Bounding Box|USB를 연결할 수 있는 단자|
|CHIPSET        |Bounding Box|주요 구성 요소들 간의 데이터 흐름을 관리하는 칩셋이다|

- 특이사항 : 부품 고장을 라벨링 안하는 이유는 데이터셋에 고장이 났다는 표시나 이미지를 확인할 수 없어서 이를 배제하였다.
- 처음엔 Expected Labeling Unit per Data가 칩 1개인 줄 알았는데, 바운딩 박스해야하는 개수 였다.
-  빛이 너무 강하거나 약해도 사람이 구분할 수 있다면(형체가 보인다면) bounding box를 한다.는 오묘한 표현이므로 이를 주변이 너무 하얗거나 너무 어두워서 edge가 흐려질 경우, bounding box하지 않는다로 바꾸는 것이 좋아보인다.

## 불량 검출 데이터 구축 시트(1번 구성용품 판별 모델)

| 주제                 | 내용                                                         |
|-----------------------|-------------------------------------------------------------|
| Data Type            | Image(jpg)                                                  |
| Data Amount          | 1200장(양품 600장, 불량품 600장), 배치 1 : 240장, 배치 2 : 960장                        |
| Expected Labeling Unit per Data | 0 ~ 9개                                               |
| Brief Description    | Bounding Box(바운딩 박스)|
| 종료 희망 날짜        | - 배치 1 : ~2025-1-24까지, - 배치 2 : ~ 2025-1-25까지       |
| Customer Guideline   | ![image](https://github.com/user-attachments/assets/b2c3a2d9-c467-41bf-bb62-80a08f8c1e6b) </br>보라색 : RASPBERRY PICO , 초록색 : HOLE, 하늘색 : BOOTSEL, 파란색 : OSCILLATOR, 빨간색 : USB, 노란색 : CHIPSET|
| Data Collection      | 자체 제작                                         |
| Annotation Type      | Bounding Box : 6종                                          |
| Class                | Bounding Box : 1. USB, 2. BOOTSEL, 3. CHIPSET , 4. OSCILLATOR,  5. RASPBERRY PICO, 6. HOLE|
| Property             | 정상 부분만 바운딩 박스한다.                                                        |
| Misc                 | 샘플이 컨베이어 벨트 밖, 혹은 카메라 범위를 벗어날 경우, 고장 부위를 판별할 수 없기 때문에 샘플은 반드시 카메라 범위 안에 들어와 있어야 한다. 또한, 카메라 범위 안에는 한 개의 샘플만이 있어야 한다. 왜냐하면 두 개의 샘플이 카메라 범위 안에 있을 경우, 둘 중 하나만 하자가 있어도 정상인 다른 샘플까지 모두 불량품으로 분류되기 때문이다. 구성용품을 바운딩 박스할 경우 엣지 기준으로 1픽셀 정도만 준다. 순서를 USB, BOOTSEL, CHIPSET, OSCILLATOR, HOLE, RASPBERRY PICO 순서로 바운딩 박스를 하여 서로 데이터를 검토할 때 무엇이 빠졌는지 확인할 수 있도록 한다.|
|Contact Info|이선우,김영수,한건희,최범석|

## 불량 검출 데이터 구축 시트(2번 불량 판별 모델)
| 주제                 | 내용                                                         |
|-----------------------|-------------------------------------------------------------|
| Data Type            | Image(jpg)                                                  |
| Data Amount          | 3720장(증강 2520장, 실제 1200장), 배치 1 : 증강 2520장, 배치 2 : 1200장                        |
| Expected Labeling Unit per Data | 1개                                               |
| Brief Description    | Bounding Box(바운딩 박스)|
| 종료 희망 날짜        | - 배치 1 : ~2025-1-29까지, - 배치 2 : ~ 2025-1-30까지       |
| Customer Guideline   | ![image](https://github.com/user-attachments/assets/02b95677-9996-467b-95b6-b79b9d65f31d) </br>파란색 : Broken , 빨간색 : Normal |
| Data Collection      | 자체 제작                                         |
| Annotation Type      | Bounding Box : 2종                                          |
| Class                | Bounding Box : 1. Broken, 2. Normal  |
| Property             | 칩(기판) 전체를 바운딩 박스한다.                                                        |
| Misc                 | 정상품 1개와 불량품 6개의 데이터를 360도 돌려서 사용했다. 왜냐하면 데이터가 적기 때문에 내부적으로 회전을 한 데이터를 이용해 학습한다.|
|Contact Info|이선우,김영수,한건희,최범석|

## FLASK UI
  - 컨테이너로 부터 온 이미지를 SuperbAI와 연결하여 웹에 이미지를 띄운다.
  - 구성용품 판별 모델과 불량 판별 모델, 원본 이미지를 웹에 띄워준다.
  - .env를 사용하여 올리기 민감한 정보를 관리하고 있다. 


    ACCESS_KEY=토큰 키 (superbAI 팀 키)</br>
    URL_1=예시 URL1 (첫번째 AI모델 URL)</br>
    URL_2=예시 URL2 (두번째 AI모델 URL)</br>


  - 사용법은 .env 파일을 생성하여
  -  환경설정을 한 후, app.py를 실행한다. 이때, 컨테이너에서 이미지를 보내는 HTTP와 superbai의 endpoint 2개가 필요하다.
## 전체 구조도

![image](https://github.com/user-attachments/assets/43a4595b-84c3-492a-9ed8-a6bafad19328)

  - 라즈베리를 통해 컨테이너, 카메라, 센서를 제어한다.
  - 플라스크를 통해 라즈베리로 부터 이미지를 HTTP를 통해 받는다.
  - 이 이미지를 superb AI의 endpoint에 보내 모델 결과를 통신 결과로 받는다.
  - 이 이미지를 웹을 통해 확인한다.
## 두 모델 선정 과정
### 구성용품 판별 모델
#### 개선 과정
  - 배치 1의 240장을 yolo 6 L-6, Deta를 돌려 성능을 확인, 성능이 바운딩 박스를 일부 못하거나, HOLE의 신뢰도가 낮은 것을 확인했다.
  - 이를 개선하기 위해 배치 2를 포함 1200개의 데이터를 학습시키고, 불량 판별 모델을 만들기로 한다. 왜냐하면 이는 모델, 데이터의 문제가 아닌 라벨링이 여러 구성용품으로 나뉘었기에 train Loss가 낮아지지 않는 현상을 발견했기 때문이다.
  - Deta 모델로 1200장을 학습하고, yolo로 불량 판별 모델을 학습하기로 결정하였다.
#### 모델 성능
  - 1200 모델의 경우 바운딩 박스를 올바르게 하긴 하지만, 부서진 구성용품을 바운딩 박스하거나 신뢰도가 60% 대가 나오는 HOLE 바운딩 박스가 있다.
#### 개선 방향
  - 실제 데이터 셋을 기반으로 데이터를 수집하여 학습시킨다. 이는 240 -> 1200장의 학습량 증가에 따른 성능이 올라갔기 때문이다.
  - 학습이 잘 안되는 class의 임베딩 분포와 현재 학습하는 데이터의 분포를 보고 어떠한 방식으로 학습해 나아갈지 정한다.
### 불량 판별 모델
#### 개선 과정
  - 증강 데이터 2520개 만 돌릴 경우, yolo6 N의 모델이 실제 데이터 셋에 대해서 성능이 좋지 않았다. 그러므로 실제 데이터를 추가하여 학습하였다. 하지만 이 경우, Normal로만 바운딩 박스를 하거나 Broken으로만 바운딩 박스를 하는 편향 문제가 두드러졌다. 이를 해결하기 위해 `정상품 : 불량품` 비율을 바꿔가면서 비교했으나 여전히 편향 문제가 있었다. 데이터 셋을 분석하니 특정 방향의 데이터가 Normal class에 분포해있다는 것을 발견하였다.
#### 모델 성능
  - Normal, Broken에 편향되어 결과가 나온다.
#### 개선 방향
  - 다양한 방향의 실제 데이터를 넣어 학습한다. 증강 데이터의 경우, 내부 yolo6 N에도 있지만, 데이터 수를 채우기 위해 사용했었다. 하지만 실제 데이터와 사용할 경우, 실험을 많이 하지 않아서 알기 어렵지만 일부 도움이 되지만 실제 데이터에 비해 성능 향상에 떨어지는 것으로 보인다. 왜냐하면 실제 데이터로 했을 경우, 바운딩 박스를 안하는 경우가 적지만, 증강 데이터를 섞을 경우, 바운딩 박스를 안하는 경우가 늘었다. 이를 해결하기 위해 증강 데이터로 모델을 학습한 후에, 실제 데이터를 학습하는 방법을 쓴다면 성능 향상이 있을 것이다. 또한 정상품과 불량품 비율을 조절하여 어느 한쪽에 오버피팅이 안되도록 한다.
  - 앞선 모델 개선 방법처럼 데이터 셋을 분석하고 어떠한 문제가 있는지 토론하여 이를 개선한다.
## 데모영상
  - 팀원들에게 유튜브 링크로 볼 수 있게 만듦
## 프로젝트 후기

|이름|소감|역할|
|----|----|----|
|[이선우](https://github.com/malenwater)|1. 문제 해결 방법 학습: 이번 프로젝트에서는 AI를 학습할 때 모델을 학습하고, 이에 대한 그래프를 보고, 어떤 문제점이 있나 발견하고, 이를 개선하기 위해 가설을 세우고, 실험하는 일련의 과정을 통해 모델을 개선하기 위한 과정을 배울 수 있었다. </br> 2. 데이터 셋 분석의 중요성 : 데이터 셋의 분포와 클래스 간의 분포가 학습에 어떤 영향을 주는지 확인할 수 ㅣ있는지 확인해봐야한다는 것을 알 수 있는 뜻 깊은 프로젝트였다. </br> 3. AI 개선을 위한 설계 중요성 : 해당 프로젝트는 데이터 셋을 만들고 모델을 학습시키고, 어떤 방향으로 개선할 지 그때 상황에 따라 학습시켰다. 그렇다 보니 현재 어떻게 흘러가는지 전체 구조도가 구체화되지 않았다. 처음에 데이터셋을 몇개 구하고, 모델을 학습시키고, 성능을 확인하고, 어떤 방향으로 데이터를 모으고 어떤 방향으로 학습시킬지를 정하지 않았다. 이로 인해 정형화된 모델 평가와 데이터 평가가 이루어지 않아 데이터 셋이 문제인지 모델 문제인지 정형화하는데 오래 걸렸다. 그렇기에 다음에는 틀을 잡고 개선하는 방식을 채용하여 AI 프로젝트를 이끌어나가고 싶다.|Flask 웹서버 및 HTML 웹 페이지 제작, 데이터 셋 구축, AI 모델(불량 판별 모델) 성능 개선|
|[한건희](https://github.com/ghgue)|더미|역할|
|[최범석](https://github.com/ausudu)|더미|역할|
|[김영수](https://github.com/youngsoo-kim-123)|1: 하지만 뜻은 깊으나 방향이 아쉽다. 내가 5일동안 열심히 동료들과 같이 ai모델을 만든건 분명 좋았던 일이지만, 이게 로봇과 무슨 관련이 있나 라는 생각이 들기도 한다. 나는 신청 떄 ai로봇 프로젝트를 할 수  있다고 들었는데, 사실상 이건 ai프로젝트이며 이것이 4차시 ai2 수업에 사용되는것도 아니다. 4차시 수업은 분명 로봇ai라 볼 수 있겠지만 그 모델의 학습을 코랩을 이용해서 학습했으며, 3차시 그러니깐 이 수업에선 superb를 활용해서 수업했기 때문에 여기서 배운 기법이 직접적으로 4차시 수업에 도움이 되지 않았다. 물론 어떻게 학습을 할 것인가, ai학습을 어떻게 하면 잘 할 수 있는가 그런건 도움이 될 수 있겠지만.. 물론 부트캠프 입장도 이해하고 기업 플랫폼을 쓴거도 기업 홍보를 위해, 또 정부 예산을 타먹기 위해 직원들이 무료로 강의해 주는거고, 결국 돈 문제인거거 알고, 공짜로 배우는 입장에서 할 말은 아닐지도 모르지만, 그래도 로봇이라는 주제는 벗어나면 안되지 않나? 라는 생각이 들기도 한다. 이론 수업에서 파이썬과 ai수업을 듣는건 나중에 실습 때 로봇을 다루기 위한 기초지식을 배우는거라고 생각했는데 막상 실습 때는 이론 때 배우지 못한 로봇위주가 아닌게 좀 아쉽다. 그래도 플랫폼은 회사가 잘 만들어 편하긴 했었으니.  2: 데이터 양이 제일 중요한거 말만 들었는지 프로젝트를 해보니 진짜 확실히 체감이 됐다. 내 생각엔 기능 구현 시간을 줄이고 하루 정도를 추가해서 사지만 찍고 있었어야 했던게 아닌가 쉽기도 하다. 물론 노가다성이 있는 작업이여서 조원들이 힘들어 했을 수도 있겠지만.. 또 우리가 전략적으로 접근했어야 했던게 당연히 데이터의 다양성이 많을 수록 데이터를 더 많이 만들어야 하는데, 그럼 당연히 데이터를 얼마나 쌓기 전에 데이터 다양성을 어떻게 해야하는지를 서로 연계해서 생각했어야 했지만, 그 점이 부족하지 않았나 싶었다. 공장에서 데이터가 얼마나 다양한지를 판단하고, 그 판단 결과를 기반으로 데이터 만들었어야 했는데, 편향된 데이터만으로 학습한 모델은 당연히 오버슈팅이 클 수 밖에 없는 점을 간과한게 아닌가 싶다. 그러니깐, 우리가 다양한 상황을 전제로 했지만, 그 다양한 상황이 꼭 필요한가? 그 다양성을 고려하는게 실제 공장에 이 ai모델을 도입 했을 때 효용성이 있는가? 그것에 대한 생각이 부족했다. 사실 이러한 생각을 할 시간을 안줬다는게 더 정확한 표현일것이다. 3: 우리의 프로젝트의 결과를 실패로 발표해버린게 매우 아쉽다. 사실 우리와 같이 일하는 사람들은 절대 우리를 신용하지 않는다. 동료들은 서로 신뢰하겠지만 생전 처음 보는 사람은 우리를 절대 신용할 수 가 없다. 미래의 가능성보다 현실의 결과가 더 신용이 있기 때문이겠지. 대기업 급이 되면 또 모르겠지만, 사실 대기업도 신용이 조금 올라가는거 뿐이지 사람들은 대기업도 실패를 한다는걸 너무나 잘안다. 이런 까닭에 실제로 프로젝트의 결과를 실패로 하는 경우는 매우 드물다. 하지만 우리는 실패를 발표했고, 실제 프로젝트와 비슷한 발표를 강조하던 강사님이 보기에 마이너스 요소가 됐을거 같다. 
실패도 포장하기에 따라 성공으로 포장이 충분히 가능하다. 우리의 모델이 어쨌든 불량인건 전부 불량으로 판단하지 않았었나? 양품도 불량이라고 한 것이 문제일 뿐이였다. 그렇다면, 우리 모델이 불량품은 일단 전부 불량품으로 잡으니, 컨셉을 사람과 로봇의 하이브리드 협동으로 잡아서, 로봇이 1차로 불량픔을 완벽한 정확도로 걸러내고, 사람이 로봇이 걸려낸 것 중에 정상품만 다시 정상으로 판정하는 시스템으로 포장을 했어도 충분했을 것이다. 우리의 문제정의, 그리고 해결 방향이 인력을 감소시켜 단가를 낮추고, 작업강도를 낮춰 노동자의 편의를 보장하는 거였으니 로봇이 불량품을 걸러내여 사람이 검수해야 할 절대적인 양을 줄이는 것만으로도 우리의 목적을 다했다고 판단 할 수 있었을 것이다.|역할|
